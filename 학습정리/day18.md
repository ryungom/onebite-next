# ⚡️ 한입 Next 강의 정리

## 열 여덟번째 날

### 패럴렐 라우트 ( 병렬라우트 )
![image](https://github.com/user-attachments/assets/9a9767e0-3f83-46c8-a7ee-decbfcee83cc)
- 이런 느낌으로 여러 페이지가 한꺼번에 병렬로 라우팅 되는것을 뜻함
- 대개 소셜미디어 서비스나 관리자 대시보드 UI에 유용하게 활용됌
- **슬롯 (slot)** 이 중요함.
  - 폴더로 만들고 '@'를 붙여줌.
  - 병렬로 만들 페이지 컴포넌트 보관하는 용도.
  - 이 폴더는 '(), 라우트그룹'처럼 URL 및 폴더 경로에 영향을 주진 않음.
  - 같은 폴더 내 레이아웃 컴포넌트에서 {children} 호출하듯 똑같이 호출하면 됌. 타입도 ReactNode로 동일.
- Next에서 사소한 오류가 있기 때문에, 바로 실행이 안될 경우 .next 폴더 삭제와 서버 재시작이 필요함.
- children 또한 일종의 @children 슬롯이 제공되어 있는것과 마찬가지임. layout에서 default로 적용될 뿐.
- 패럴랠 라우트에 추가되는 slot에는 갯수제한이 없음.
- 슬롯 안에 하위 페이지를 만들게 되면 다른 슬롯은 이전 컴포넌트 유지게하게 됌. (이유 : 갈곳없어서)
  - 이전 페이지 유지하는건 CSR방식을 이동할때에만 가능.
  - 새로고침해서 슬롯 하위 경로로 페이지를 접속하는 순간 슬로이 이전페이지가 없으니 새로고침 하는 순간 없는 페이지가 생성됌.
    - 이런 경우에는 해당 슬롯의 하위 페이지에 default.tsx, function Default (){} 추가하면 새로고침 하더라도 페이지 유지 가능. (이전페이지 === Default 페이지 활용)

## 인터셉팅 라우트
- ![image](https://github.com/user-attachments/assets/e3700f3f-b81b-4988-a97c-12e975517ad7)
- 이런식으로 동작하는 페이지. 특정조건을 만족하면 다른 페이지로 보여질 수 있게끔 하는 것.
  - 조건은 따로 직접 설정은 못함. next에서 고정적으로 정해짐. **초기 접속 요청이 아닐 때에만 인터셉트 라우트 동작**. 링크 컴포넌트, route.push 등 CSR 방식으로 이동했을때에만 인터셉트 라우트 동작.
  - 대표적인 예시 : 인스타그램. 새로고침하면 인터셉트 동작하지 않고 그 페이지의 상세페이지로 이동
- 인터셉트할 폴더명과 똑같이 만들고 앞에 경로를 붙임
  - (.) : 상대경로. './' 랑 동일. 동일한 경로의 페이지 가리킴
  - (..) : 한 단계 상위경로. '../'과 동일.
  - (..)(..) : 두 단계 상위 경로. (..)가 붙을수록 상위경로로 올라감
  - (...) : app 폴더 바로 하위 폴더 인터셉트.
- 만드는 방법
  - 인터셉트한 페이지에서 import로 페이지 경로를 호출.
  - 하위 프롭스를 (id등등) 그대로 인터셉트해서 가져오려면 props:any로 불러오고 컴포넌트에는 전개연산자로 {...props}를 넣어주면 그대로 딸려옴.
- 모달 컴포넌트를 만들어서 인터셉팅한 페이지를 모달로 띄워주면 직관적인 인터셉트 ui를 보여줄 수 있음
  - 모달로 만들지 않으면 하위 컴포넌트로 만들어야 하기 때문에, 페이지가 보기에 어색함. 
  - 클라이언트 컴포넌트로 생성해야 함. 
  - return 문 안에 createPortal을 넘겨줘야 하고, 인수로 2개를 받는데 1번째는 컴포넌트(children이 포함된), 두번째는 dom탐색으로 모달이 호출될 아이디를 찾아주면 됌.
  - root layout에 앞서 호출될 아이디가 있는 DOM 요소를 만들어줌.
  - Modal 컴포넌트가 완성되었으면 인터셉트하는 페이지의 children 부분을 Modal 컴포넌트로 감싸줌
  - <dialog>태그는 초기에 로딩되면 꺼진상태로 호출이 됌. ref를 지정해준 다음 useEffect로 모달컴포넌트마 마운트 되면 showModal() 함수를 호출해주도록 지정.
  ![image](https://github.com/user-attachments/assets/159cd631-9f23-421f-9c5f-0f6be126aaa4)
  - dialog태그를 쓰고 활성화하면 뒷배경이 가상선택자로 backdrop 태그가 생성됨. 이 태그에 배경값을 넣어줘서 dimmed UI 생성 가능.
- 모달을 꺼버리는 방법
  - useRouter를 이용해서 router.back() 메서드를 이용.
  - dialog 태그를 클릭하되 모달의 배경이 클릭이 된 것이면 뒤로가기 설정을 해주면 됌.
    - `e.target.nodeName ==='DIALOG'` 를 설정해주면 배경 클릭한것이 됌
    - 타입스크립트가 오류를 발생시키다면 `(e.target as any).nodeName ==='DIALOG'` 지정 가능.
  - onClose() 함수에도 똑같은 route.back() 호출하면 esc 누르는 순간 뒤로가기 호출됌.

### 페럴랠 + 인터셉트 라우트 적용
- 위 방법대로 적용하게 되면 모달이 띄워지긴 하되 뒷 배경이 어색함. 뒷배경에 이전페이지가 적용이 되질 않음.
- 이전 페이지가 **병렬**로 라우팅이 적용되서 호출되어야 함.
- root layout 에 페럴랠 라우트로 @modal 슬롯을 설정해둔 후 layout에 children과 함께 모달이 호출될 수 있도록 작업.
- 에러처리
  - '/' 인덱스로 들어왔을 경우는 모달이 존재할 수 없으므로 이렇게 없는 경우도 봐야 함으로 페럴랠 라우트 슬롯 폴더 안에 default 페이지를 만들어주고, return null을 넣어주도록 함.
  - '/' 인덱스로 들어왔을 경우 null로 보이도록 하기 위함. 즉 children의 page 컴포넌트만 호출하게 될것임.

### 느낀점
- 모달을 띄울때 지금까지는 한 페이지 안에서 컴포넌트에 스타일을 붙여서 DOM 조작 하는 방식으로 작업했었는데, 이렇게 라우팅 방식과 createPortal, dialog로 작업하는 방식은 처음이었다. 내 기존 프로젝트에도 이런 방식으로 패럴랠 라우트와 인터셉트 라우트로 모달을 띄워줄 수 있겠다 싶었다. 다만 보편적인 모달은 인터셉트로 만들면 안될것 같고 상세페이지 정도만 이렇게 인터셉트로 만드는것이 좋겠다. 계속 모달로 나와야 하는것은 portal로 관리가 가능할것 같다. 간만에 새롭고 신선한 내용을 정리할 수 있어서 효능감이 팍팍... 열심히 정리한거 몇번이고 읽어봐야겠다.
