# ⚡️ 한입 Next 강의 정리

## 일곱째날

### 사전랜더링 (2nd: 정적사이트 생성 | SSG)
- 서버상태가 안좋거나 주고받아야할 데이터가 많아질때 사용되는 랜더링 방법.
  - 이말인즉슨 이 말은 SSR의 단점임. 시간이 길어지면 치명적임. 빌드타임에 미리 사전랜더링하여 SSR의 단점을 해결하는 방식
  - 서버가 가동되기 이전에 발생하기 때문에 사용자 인터렉션과는 무관한 사전작업이 가능해짐.
  - 단점으로는 매번 똑같은 페이지만 응답하기에 최신 데이터 반영이 어려움. 따라서 자주 바뀌지 않는 정적인 페이지 랜더링에 효과적임. 새로운 페이지 만들어내는것에는 부적합.
    - 왜냐하면 빌드는 맨처음 배포될때 처음에만 빌드되니까...!!
### SSR -> SSG로 만드는 방법
- 페이지라우터의 getServerSideProps 함수를 getStaticProps로 변경
- 반환값이든 props 넘겨주는것이든 사용법은 SSR 방식 함수랑 동일함.
- 타입만 바뀜. InferGetStaticPropsType
- 따로 getServerSideProps나 getStaticProps를 설정해주지 않은 페이지는 기본적으로 static한 페이지, 기본 SSG 페이지가 된다
- 단점 : 빌드타임에 생성되기 때문에, query string 값을 미리 알 수가 없다.
- 쿼리스트링이나 브라우저 제공값등이 필요하다면 **기본 base가 SSG 방식**인것을 이용하여 기존 리액트 방식으로 useState와 useEffect 안에서 작업하면 된다.
 
### 동적 경로에 적용하는 방법
- 동적 경로는 여러개의 페이지가 있을 수 있기 때문에 빌드타임때 존재할 수 있는 모든 경로들을 미리 설정해두어야 함.
  - 이걸 도와주는것이 getStaticPaths
  - 이후 getStaticProps로 넘겨주어야 함.
  - fallback 옵션은 해당되지 않는 페이지일 경우 없는 404페이지로 리턴되도록 도와주는 값. 없는셈 치게 하려면 기본으로 false를 넣어주면 됌.
- fallback 옵션 적용방법
  - 기본적인 fallback상태 : 페이지 컴포넌트가 아직 서버로부터 데이터를 전달받지 못한 상태 
  - false
    - 나머지를 false로 해두면 이후 새롭게 추가된 페이지들은 모두 전부 not found 페이지 반환하게 됌.
  - blocking
    - 새롭게 즉각적으로 빌드타임 이후 SSG 방식으로 생성해둠.
    - 한번만 만들어두면 next 서버에 저장되기 때문에 이후 새로고침하면 빠르게 화면에 랜더링 됌.
    - 새로운 데이터가 계속 추가되어야 하는 상황에서 사용 가능
    - 주의 : **존재하지 않는 페이지 생성시 새롭게 데이터를 요청해야하면 로딩이 발생**
  - true
    - props가 없는 페이지(getStaticProps가 없는 페이지) 사전랜더링 후 반환.
    - 그 이후 props 계산 후 props만 따로 반환하여 데이터가 있는 상태 페이지 랜더링.
    - blocking 기능을 기본으로 가져간 다음 데이터 페칭 로딩 페이지를 보여줄 수 있음.
  - fallback상태를 catch 하려면 route 객체의 isFallback 사용. (true /false)
    - 하단 컴포넌트에서 route.isFallback 조건문과 데이터가 없는경우를 같이 써주면 순서대로 진행.
    - 만약 오류가 아닌 404페이지로 넘기고 싶다면 getStaticProps에서 조건문을 달아서 return값으로 notFound:ture 객체를 보내면 됌
---
### 느낀점
- 개념적으로 알고 있던 SSR과 SSG에 대해서 직접적으로 알 수 있게 되었다. 사전랜더링 방식이 Next의 가장 큰 장점이 아닐까 싶다. 특히 fallback옵션은 모건님과 같이 작업하면서 프로젝트 후반 잠시 좀 막혔던 부분이었는데 어떤 옵션인지 정확하게 알 수 있었던것 같다. 그리고 계속해서 앱라우터에서는 이렇게 썼었지 하는 기억들이 스멀스멀 올라오게 된다. 빨리 이 내용을 토대로 앱라우터로 넘어가보고 싶다.
