# ⚡️ 한입 Next 강의 정리

## 열 네번째 날

### 라우트 세그먼트 옵션
- 특정 페이지의 캐시나 revalidate 동작을 강제로 설정할 수 있도록 하게끔 함.
- 우린 이미 사용해본적이 있음. dynamicParams.
- dynamic 옵션을 사용하면 해당 페이지가 어떻게 랜더링을 하든 이유불분 강제로 static, dynamic으로 설정할 수 있게 됌. 옵션을 총 4가지 임 (string으로 값이 들어가야 함)
  - auto : 기본값. 아무것도 강제 안함.
  - force-dynamic : 페이지를 강제로 dynamic으로 변경.
  - force-static : 페이지를 강제로 static으로 변경. 동적함수들은 undefined를 반환하도록 설정됌. no-cache 옵션으로 데이터를 호출하더라도 무조건 데이터 캐싱하도록 함.
    - 다만 강제로 작업하게 되기 때문에 동적 함수가 작동안하게 될 수 있음.
    - 부작용이 따라올 수 있다는검을 감안. 
  - error : 강제로 static으로 변경하게 하는, 비슷한 옵션. 다만 현재 페이지가 static으로 변경되지 못할 이유가 있으면 build오류를 발생 시키게 만듦.
- **해당 옵션 특별한 상황이 아니면 해당 '라우트 세그먼트 옵션'을 쓰길 바라지 않길 바람.**
  - 그럼에도 쓰는 이유 : 옵션을 알고라도 있으면 페이지 캐싱 실험, 무조건 static, dynamic 설정되어야 하는 페이지에 빠르게 적용해본 다음 천천히 고쳐나가는 식으로 개발해 나가는것이 베스트.

### 클라이언트 라우터 캐시
- 브라우저측에 저장되는 캐시.
- 넥스트에 저장되는 페이지의 일부 데이터를 보관해두는 기능.
- 한번 접속된, 공통된 RSC Payload에 포함된 레이아웃을 '클라이언트 라우터 캐시'라는 클라이언트 캐시에 저장해두는 기능이라고 해도 무관. 서버에 따로 요청하지 않아도 됌.
  - ![image](https://github.com/user-attachments/assets/958986fe-a1f0-4235-a494-138c5094deb2)
- 새로고침이 되면 모두 사라지게 됌
- 따로 설정해주는 부분이 아닌, 어떻게해서 공통 컴포넌트를 가진 페이지들이 빠르게 로딩되는지 그 이유에 대해서 알려주는 파트.

### 스트리밍
- 큰 용량의 동영상을 아주 빠른 속도로 시청할 수 있게 해주는 것.
- 엄청 큰 용량의 파일을 서버에서 보내줄때 그 데이터를 잘개 쪼개서 연속적으로 보내주는 기술.
  - like 이미지를 슬라이스해서 로딩속도 줄여주는 기술이랑 비슷한것일까나?
- next에서는 일반적인 웹 서비스에도 똑같이 적용할 수 있게 만들어줌.
- 일단 뭐라도 빠르게 보여줄 수 있게 만들어줌. 느리게 랜더링 되는 부분은 로딩바같은 대체 ui를 보여주면 됌.
- 비동기적인 작업이 아닌 컴포넌트들을 먼저 빠르게 보여주고 비동기작업은 뒤늦게 페이지에 보여주게 되는 동작 방식.
- 주로 Dynamic 페이지에서 많이 활용이 됌.
- 마치 음식점에서 주문하고 메인요리 나오기 전 밑반찬부터 빠르게 내어주는 것과 비슷함.
- 즉 오래걸리는 컴포넌트의 랜더링을 사용자가 더 좋은 환경에서 기다릴 수 있도록 해주는 것.
- 사용방법 : 페이지가 랜더링 되는 동일한 폴더 내에 loading.tsx 파일을 만들어두고 Loading 컴포넌트를 export 해주면 됌.
- 주의사항
  - 해당하는 경로 아래에 있는 모든 파일에 적용이 됌. layout과 결을 같이 함.
  - async가 붙어있는 비동기 컴포넌트에서만 적용이 됌.
  - page 컴포넌트에서만 스트리밍 적용이 가능. 그 외 컴포넌트에서는 suspense를 사용해야 함.
  - 쿼리스트링이 변경되는 것에 대해서는 트리거가 걸리지 않음. 이 케이스 또한 suspence를 사용해야 함.

---
### 느낀점
- 빨리 다음수업에 예정되어 있는 suspense에 대해서도 제대로 알아보고 싶다. 스트리밍의 loading.tsx가 전역 말고도 컴포넌트 하위에서도 적용될 수 있다는건, 그리고 suspense import 없이도 사용될 수 있다는점은 처음 알았다. 비록 page컴포넌트와 비동기 async 호출에 한해서라는 조건이 붙긴 하지만.
